!function(r,t,n,e){var o={init:function(){o.compare_temp_2=r.eddMetrics.compare_string_2,o.revenue=r.eddMetrics.revenue,o.downloads=r.eddMetrics.downloads,o.doCal()},doCal:function(){new Calendar({element:n(".metrics-datepicker"),presets:[{label:"Last 30 days",start:moment().subtract(29,"days"),end:moment()},{label:"This month",start:moment().startOf("month"),end:moment().endOf("month")},{label:"Last month",start:moment().subtract(1,"month").startOf("month"),end:moment().subtract(1,"month").endOf("month")},{label:"Last 7 days",start:moment().subtract(6,"days"),end:moment()},{label:"Last 3 months",start:moment(this.latest_date).subtract(3,"month").startOf("month"),end:moment(this.latest_date).subtract(1,"month").endOf("month")}],earliest_date:"January 1, 2006",latest_date:moment(),start_date:moment().subtract(29,"days"),end_date:moment(),callback:o.callback}).calendarSaveDates()},callback:function(){var e={action:"metrics_batch_1",start:moment(this.start_date).format("LL"),end:moment(this.end_date).format("LL")},a='<div id="circleG"><div id="circleG_1" class="circleG"></div><div id="circleG_2" class="circleG"></div><div id="circleG_3" class="circleG"></div></div>';n(".edd-metrics-box h2").html(a),n(".edd-metrics-box .bottom-text span").html("").removeClass(),n(this.element[0]).hasClass("metrics-detail")?(n(".edd-metrics-chart-wrapper").append(a),n.post(r.ajaxurl,e,o.detailResponse).then(function(){e.action="metrics_batch_2",n.post(r.ajaxurl,e,o.detailResponse_2)}).fail(function(){console.warn("ajax error")})):n.post(r.ajaxurl,e,o.dashResponse).then(function(){e.action="metrics_batch_2",n.post(r.ajaxurl,e,o.batch2response)}).fail(function(){console.warn("ajax error")})},dashResponse:function(e){var a=JSON.parse(e),s=r.eddMetrics.compare_string+" "+a.dates.num_days+" "+r.eddMetrics.days;n("#revenue").html(a.earnings.total),n("#revenue-compare").addClass(a.earnings.compare.classes),n("#revenue-compare span").html(a.earnings.compare.percentage+s).removeClass().addClass(a.earnings.compare.classes),n("#sales").html(a.sales.count),n("#sales-compare").addClass(a.sales.compare.classes),n("#sales-compare span").html(a.sales.compare.percentage+s).removeClass().addClass(a.sales.compare.classes),n("#avgpercust").html(a.earnings.avgpercust.total),n("#avgpercust-compare").addClass(a.earnings.avgpercust.compare.classes),n("#avgpercust-compare span").html(a.earnings.avgpercust.compare.percentage+s).removeClass().addClass(a.earnings.avgpercust.compare.classes),n("#refunds").html(a.earnings.refunds.count),n("#refund-amount").html(a.earnings.refunds.losses),n("#refunds-compare").addClass(a.earnings.refunds.compare.classes),n("#refunds-compare span").html(a.earnings.refunds.compare.percentage+s).removeClass().addClass(a.earnings.refunds.compare.classes)},batch2response:function(e){var a=JSON.parse(e),s=r.eddMetrics.compare_string+" "+a.dates.num_days+" "+r.eddMetrics.days;n("#earnings-today").html(a.earnings.detail.today),n("#renewals").length&&(n("#renewals").html(a.renewals.count),n("#renewal-amount").html(a.renewals.earnings),n("#renewals-compare").addClass(a.renewals.compare.classes),n("#renewals-compare span").html(a.renewals.compare.percentage+s).removeClass().addClass(a.renewals.compare.classes)),n("#subscriptions").length&&(n("#subscriptions").html(a.subscriptions.number.count),n("#subscriptions-compare").addClass(a.subscriptions.number.compare.classes),n("#subscriptions-compare span").html(a.subscriptions.number.compare.percentage+s).removeClass().addClass(a.subscriptions.number.compare.classes),n("#recurring-revenue").html(a.subscriptions.earnings.total),n("#recurring-revenue-30").html(a.subscriptions.earnings30)),n("#discounts").html(a.discounts.now.amount),n("#discounts-count").html(a.discounts.now.count),n("#discounts-compare").addClass(a.discounts.compare.classes),n("#discounts-compare span").html(a.discounts.compare.percentage+s).removeClass().addClass(a.discounts.compare.classes),n("#commissions").length&&(n("#commissions").html(a.commissions.count),n("#commissions-amount").html(a.commissions.earnings))},detailResponse:function(e){var a=JSON.parse(e);switch(o.getQueryVariable("metric")){case"revenue":n("#revenue").html(a.earnings.total),n("#revenue-compare").addClass(a.earnings.compare.classes),n("#revenue-compare span").html(a.earnings.compare.percentage+o.compare_temp_2).removeClass().addClass(a.earnings.compare.classes),n(".detail-compare-first").html(a.earnings.compare.total),n("#monthly h2").html(a.earnings.avgmonthly.earnings),n("#new-customers h2").html(a.earnings.avgpercust.current_customers),n("#new-customers span").html("This period"),n(".detail-compare-first").html(a.earnings.compare.total),n("#box-4 .bottom-text span").html(a.earnings.compare.percentage+"%")}o.doLineChart(a.lineChart),n(".edd-metrics-chart-wrapper #circleG").remove()},detailResponse_2:function(e){var a=JSON.parse(e);switch(o.getQueryVariable("metric")){case"revenue":n("#revenue-6mocompare").addClass(a.earnings.detail.sixmoago.classes),n("#revenue-6mocompare span").html(a.earnings.detail.sixmoago.compare+o.compare_temp_2).removeClass().addClass(a.earnings.detail.sixmoago.classes),n(".detail-compare-second").html(a.earnings.detail.sixmoago.total),n(".detail-compare-third").html(a.earnings.detail.twelvemoago.total),n("#revenue-12mocompare").addClass(a.earnings.detail.twelvemoago.classes),n("#revenue-12mocompare span").html(a.earnings.detail.twelvemoago.compare+o.compare_temp_2).removeClass().addClass(a.earnings.detail.twelvemoago.classes),n("#earnings-today h2").html(a.earnings.detail.today),n("#earnings-this-month h2").html(a.earnings.detail.this_month),n("#renewal-rate h2").html(a.yearly_renewal_rate.percent+"%"),n("#yearly-renewal-compare span").html("Last "+a.yearly_renewal_rate.period+" days"),n("#box-5 .bottom-text span").html(a.earnings.detail.sixmoago.compare+"%"),n(".detail-compare-second").html(a.earnings.detail.sixmoago.total),n(".detail-compare-third").html(a.earnings.detail.twelvemoago.total)}o.doDownloadChart(a.pieChart),o.doGatewayChart(a.earnings.gateways)},getQueryVariable:function(e){for(var a=r.location.search.substring(1).split("&"),s=0;s<a.length;s++){var t=a[s].split("=");if(t[0]==e)return t[1]}return!1},doLineChart:function(e){o.lineChart&&o.lineChart.destroy();var a={labels:e.labels,datasets:[{label:o.revenue,fill:!0,lineTension:.1,backgroundColor:"rgba(0,115,170,.2)",borderColor:"#0073aa",borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:"#0073aa",pointBackgroundColor:"#fff",pointBorderWidth:2,pointHoverRadius:5,pointHoverBackgroundColor:"#0073aa",pointHoverBorderColor:"rgba(220,220,220,1)",pointHoverBorderWidth:2,pointRadius:4,pointHitRadius:10,data:e.earnings,spanGaps:!1}]},s=t.getElementById("metrics-line-chart");o.lineChart=new Chart(s,{type:"line",data:a,options:{scales:{xAxes:[{display:!1,stacked:!0}]}}})},doDownloadChart:function(e){o.downloadChart&&o.downloadChart.destroy();var a={labels:e.labels,datasets:[{label:o.downloads,data:e.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]},s=t.getElementById("metrics-piechart-by-download");o.downloadChart=new Chart(s,{type:"pie",data:a})},doGatewayChart:function(e){o.gatewayChart&&o.gatewayChart.destroy();var a={labels:e.labels,datasets:[{label:o.downloads,data:e.earnings,backgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"],hoverBackgroundColor:["#225378","#1695A3","#1fa739","#EB7F00","#EB4B4D","#EBA945","#663300","#79EB65"]}]},s=t.getElementById("metrics-piechart-by-gateway");o.gatewayChart=new Chart(s,{type:"pie",data:a})}};jQuery(t).ready(o.init)}(window,document,jQuery);